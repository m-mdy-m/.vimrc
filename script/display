#!/bin/bash
source "${BASE_DIR}/colors"
source "${BASE_DIR}/logger"

# Animation delay
FAST_DELAY=0.02
NORMAL_DELAY=0.05
SLOW_DELAY=0.1

# Clear screen and display banner
display_banner() {
    clear
    
    # Simple VEX ASCII Art
    local banner=(
        ""
        "  ╦  ╦ ╔═╗ ═╗ ╦"
        "  ╚╗╔╝ ║╣  ╔╩╦╝"
        "   ╚╝  ╚═╝ ╩ ╚═"
        ""
    )
    
    # Print banner with gradient effect
    echo -e "${CYAN}${BOLD}"
    for line in "${banner[@]}"; do
        echo "        $line"
        sleep $FAST_DELAY
    done
    echo -e "${RESET}"
    
    # Tagline
    echo -e "${GRAY}${DIM}        Vim Ecosystem Extension${RESET}"
    echo ""
    sleep $NORMAL_DELAY
}

# Display minimal header
display_header() {
    local title="$1"
    local width=50
    
    echo ""
    echo -e "${CYAN}${BOLD}  $title${RESET}"
    printf "${GRAY}  "
    printf '─%.0s' $(seq 1 $width)
    echo -e "${RESET}"
    echo ""
}

# Display step with icon
display_step() {
    local step_num="$1"
    local total_steps="$2"
    local message="$3"
    
    echo -e "${BLUE}  [$step_num/$total_steps]${RESET} $message"
}

# Display completion message
display_completion() {
    local message="$1"
    
    echo ""
    echo -e "${GREEN}${BOLD}  ✓ $message${RESET}"
    echo ""
}

# Display error with icon
display_error() {
    local message="$1"
    
    echo ""
    echo -e "${RED}${BOLD}  ✗ $message${RESET}"
    echo ""
}

# Display warning
display_warning() {
    local message="$1"
    
    echo -e "${YELLOW}  ⚠ $message${RESET}"
}

# Display info
display_info() {
    local message="$1"
    
    echo -e "${CYAN}  ℹ $message${RESET}"
}

# Display success item
display_success_item() {
    local message="$1"
    
    echo -e "${GREEN}  ✓${RESET} $message"
}

# Display list item
display_list_item() {
    local message="$1"
    
    echo -e "${GRAY}  •${RESET} $message"
}

# Progress bar animation
show_progress() {
    local duration=$1
    local message="$2"
    local width=30
    
    echo -n "  $message ["
    
    for ((i=0; i<=width; i++)); do
        printf "${GREEN}▓${RESET}"
        printf "${GRAY}"
        printf '░%.0s' $(seq $i $width)
        printf "${RESET}]"
        sleep $(echo "$duration / $width" | bc -l)
        printf "\r  $message ["
    done
    
    printf "${GREEN}"
    printf '▓%.0s' $(seq 1 $width)
    printf "${RESET}]\n"
}

# Spinner animation
show_spinner() {
    local pid=$1
    local message="$2"
    local spinstr='⠋⠙⠹⠸⠼⠴⠦⠧⠇⠏'
    
    while kill -0 $pid 2>/dev/null; do
        local temp=${spinstr#?}
        printf "\r  ${CYAN}%c${RESET} %s" "$spinstr" "$message"
        spinstr=$temp${spinstr%"$temp"}
        sleep 0.1
    done
    
    printf "\r  ${GREEN}✓${RESET} %s\n" "$message"
}

# Display table header
display_table_header() {
    local col1="$1"
    local col2="$2"
    local col3="$3"
    
    echo ""
    printf "${BOLD}  %-20s %-25s %-15s${RESET}\n" "$col1" "$col2" "$col3"
    printf "${GRAY}  "
    printf '─%.0s' $(seq 1 70)
    echo -e "${RESET}"
}

# Display table row
display_table_row() {
    local col1="$1"
    local col2="$2"
    local col3="$3"
    
    printf "  %-20s %-25s %-15s\n" "$col1" "$col2" "$col3"
}

# Display section divider
display_divider() {
    echo ""
    echo -e "${GRAY}  ────────────────────────────────────────────────${RESET}"
    echo ""
}

# Box message
display_box() {
    local message="$1"
    local color="${2:-$CYAN}"
    local width=50
    
    echo ""
    echo -e "${color}  ╔$(printf '═%.0s' $(seq 1 $width))╗${RESET}"
    echo -e "${color}  ║${RESET}  $(printf "%-${width}s" "$message")${color}║${RESET}"
    echo -e "${color}  ╚$(printf '═%.0s' $(seq 1 $width))╝${RESET}"
    echo ""
}

display_prompt() {
    local message="$1"
    local default="${2:-n}"
    
    if [ "$default" = "y" ]; then
        echo -en "${YELLOW}  ? $message [Y/n]:${RESET} "
    else
        echo -en "${YELLOW}  ? $message [y/N]:${RESET} "
    fi
}

# Display key-value pair
display_kv() {
    local key="$1"
    local value="$2"
    
    printf "  ${GRAY}%-15s${RESET} %s\n" "$key:" "$value"
}

# Export functions
export -f display_banner
export -f display_header
export -f display_step
export -f display_completion
export -f display_error
export -f display_warning
export -f display_info
export -f display_success_item
export -f display_list_item
export -f show_progress
export -f show_spinner
export -f display_table_header
export -f display_table_row
export -f display_divider
export -f display_box
export -f display_prompt
export -f display_kv
